{% extends "baseAdmin.html" %}

{% block title %}Gestión de Paciente - {{ paciente.nombre if paciente else '...' }}{% endblock %}

{% block page_title %}
    <i class="fas fa-user-injured"></i> Gestión de Paciente
{% endblock %}

{% block admin_content %}
<style>
    /* Estilos específicos para esta página */
    .patient-info-panel {
        background-color: #f8fafc;
        border: 1px solid var(--color-borde);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
    }
    .patient-info-panel h2 {
        color: var(--color-sidebar);
        font-size: 20px;
        margin-top: 0;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--color-borde);
        padding-bottom: 15px;
    }
    .patient-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px 25px;
    }
    .detail-item {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .detail-label {
        font-weight: 600;
        color: var(--color-texto);
    }
    .detail-value {
        color: #64748b;
    }

    /* Estilo de los botones de acción como tarjetas */
    .action-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
    }
    .action-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 25px;
        border-radius: 12px;
        background-color: white;
        border: 1px solid var(--color-borde);
        text-decoration: none;
        color: var(--color-texto);
        transition: all 0.3s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.03);
    }
    .action-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.08);
        border-color: var(--color-principal);
        color: var(--color-principal);
    }
    .action-card .icon {
        font-size: 36px;
        color: var(--color-principal);
        margin-bottom: 15px;
    }
    .action-card .title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 5px;
    }
    .action-card .description {
        font-size: 13px;
        color: #64748b;
        line-height: 1.4;
    }
    .no-patient-state {
        text-align: center;
        padding: 50px;
        color: #64748b;
    }
</style>

{% if paciente %}
    <div class="patient-info-panel">
        <h2>{{ paciente.nombre }}</h2>
        <div class="patient-details">
            <div class="detail-item"><span class="detail-label">Cédula:</span><span class="detail-value">{{ paciente.cedula }}</span></div>
            <div class="detail-item"><span class="detail-label">Teléfono:</span><span class="detail-value">{{ paciente.telefono }}</span></div>
            <div class="detail-item"><span class="detail-label">Email:</span><span class="detail-value">{{ paciente.email }}</span></div>
            <div class="detail-item">
                <span class="detail-label">Edad:</span>
                <span class="detail-value" id="patient-age">Calculando...</span>
            </div>
            <div class="detail-item"><span class="detail-label">Aseguradora:</span><span class="detail-value">{{ paciente.aseguradora }}</span></div>
        </div>
    </div>

    <div class="action-buttons">
        <a href="{{ url_for('historial', patientId=paciente.id) }}" class="action-card">
            <span class="icon"><i class="fas fa-notes-medical"></i></span>
            <div class="title">Historial Clínico</div>
            <div class="description">Consultas, archivos y antecedentes</div>
        </a>
        <a href="{{ url_for('indexCita', patientId=paciente.id) }}" class="action-card">
            <span class="icon"><i class="fas fa-calendar-alt"></i></span>
            <div class="title">Ver Citas</div>
            <div class="description">Consultar el historial de citas</div>
        </a>
        <a href="{{ url_for('estado_cuenta_paciente', paciente_id=paciente.id) }}" class="action-card">
            <span class="icon"><i class="fas fa-file-invoice-dollar"></i></span>
            <div class="title">Estado de Cuenta</div>
            <div class="description">Facturas, pagos y planes financieros</div>
        </a>
        <a href="{{ url_for('nueva_consulta', patientId=paciente.id) }}" class="action-card">
            <span class="icon"><i class="fas fa-stethoscope"></i></span>
            <div class="title">Nueva Consulta</div>
            <div class="description">Registrar una nueva visita médica</div>
        </a>
        <a href="{{ url_for('listar_planes_paciente', paciente_id=paciente.id) }}" class="action-card">
            <span class="icon"><i class="fas fa-project-diagram"></i></span>
            <div class="title">Planes de Tratamiento</div>
            <div class="description">Crear y gestionar planes dentales</div>
        </a>
        <a href="{{ url_for('editar', id=paciente.id) }}" class="action-card">
            <span class="icon"><i class="fas fa-user-edit"></i></span>
            <div class="title">Editar Paciente</div>
            <div class="description">Modificar datos personales</div>
        </a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            const birthDateStr = '{{ paciente.nacimiento.strftime("%Y-%m-%d") if paciente.nacimiento else "" }}';
            
            if (birthDateStr) {
                const birthDate = new Date(birthDateStr);
                const today = new Date();
                
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDifference = today.getMonth() - birthDate.getMonth();
                
                
                if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
            
                document.getElementById('patient-age').textContent = `${age} años`;
            } else {
                
                document.getElementById('patient-age').textContent = 'No registrada';
            }
        });
    </script>

{% else %}
    <div class="no-patient-state">
        <h3><i class="fas fa-search"></i> No hay paciente seleccionado</h3>
        <p>Por favor, busca y selecciona un paciente para ver sus opciones.</p>
    </div>
{% endif %}

{% endblock %}